create type public.user_status as enum ('ONLINE', 'OFFLINE');

create table public.users ( 
	id  		 uuid not null primary key,
	username text,
	status	 user_status default 'OFFLINE'::public.user_status
);
comment on column public.users.id is 'References the internal Supabase auth user.';

create table public.groups (
	id 				 bigint generated by default as identity primary key
		 				 (minvalue 0 start with 0 increment by 1),
	name 			 varchar(48),
	is_trashed boolean,
	user_id uuid references public.users not null
);

create table public.notes (
	id         bigint generated by default as identity primary key
		         (minvalue 0 start with 0 increment by 1),
	name       varchar(48),
	content 	 text,
	is_trashed boolean,
	group_id   bigint references public.groups,
	user_id uuid references public.users not null
);

-- SECURE THE TABLES
alter table public.users enable row level security;
alter table public.groups enable row level security;
alter table public.notes enable row level security;
-- users
create policy "Allow individual insert access" on public.users for insert with check ( auth.uid() = id);
-- groups
create policy "User can access own groups" on public.groups for select using ( auth.uid() = user_id);
create policy "User can insert own groups" on public.groups for insert with check ( auth.uid() = user_id);
create policy "User can update own groups" on public.groups for update using ( auth.uid() = user_id);
create policy "User can delete own groups" on public.groups for delete using ( auth.uid() = user_id);
-- notes
create policy "User can access own notes" on public.notes for select using ( auth.uid() = user_id);
create policy "User can insert own notes" on public.notes for insert with check ( auth.uid() = user_id);
create policy "User can update own notes" on public.notes for update using ( auth.uid() = user_id);
create policy "User can delete own notes" on public.notes for delete using ( auth.uid() = user_id);
